<script>
let characterData = {};
let characterName = "alice";
let weather = "sunny";

// 初期化
async function loadCharacterData() {
  const res = await fetch("data.json");
  characterData = await res.json();
  updateUI();
}

// 時間帯判定
function getTimeSlot(hour) {
  if (hour >= 4 && hour < 7) return 'early_morning';
  if (hour >= 7 && hour < 11) return 'morning';
  if (hour >= 11 && hour < 15) return 'afternoon';
  if (hour >= 15 && hour < 18) return 'evening';
  if (hour >= 18 && hour < 22) return 'night';
  return 'midnight';
}

function updateUI() {
  const hour = new Date().getHours();
  const timeSlot = getTimeSlot(hour);
  const charInfo = characterData[characterName];
  const expression = charInfo.expressions[timeSlot];
  const line = charInfo.lines[timeSlot];

  document.getElementById("character").src = `img/${characterName}_${expression}.png`;
  document.getElementById("background").style.backgroundImage =
    `url('img/background_${timeSlot}_${weather}.png')`;
  document.getElementById("caption").textContent = line;
}

// キャラ・天気変更
function setCharacter(name) {
  characterName = name;
  updateUI();
}

function setWeather(newWeather) {
  weather = newWeather;
  updateUI();
}

// 起動時
window.onload = () => {
  const urlParams = new URLSearchParams(window.location.search);
  if (urlParams.has("char")) {
    characterName = urlParams.get("char");
  }
  loadCharacterData();
};
</script>
